readDir(random(randomDirection(direction(1)))).
readGriglia(griglia(griglia(player(x(8))))).
readGriglia(griglia(griglia(player(y(10))))).
readGriglia(griglia(griglia(mappa(0,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(1,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(2,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(3,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(4,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(5,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(6,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(7,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(8,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(9,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(10,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(11,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(12,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(13,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(14,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(15,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(16,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(17,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(18,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(19,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(20,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(21,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(22,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(23,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(24,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(25,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(26,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(27,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(28,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(29,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(30,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(31,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(32,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(33,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(34,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(35,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(36,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(37,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(38,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(39,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(40,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(41,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(42,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(43,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(44,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(45,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(46,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(47,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(48,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(49,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(50,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(51,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(52,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(53,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(54,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(55,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(56,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(57,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(58,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(59,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(60,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(61,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(62,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(63,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(64,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(65,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(66,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(67,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(68,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(69,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(70,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(71,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(72,cella(x(5)))))).
readGriglia(griglia(griglia(mappa(73,cella(x(6)))))).
readGriglia(griglia(griglia(mappa(74,cella(x(7)))))).
readGriglia(griglia(griglia(mappa(75,cella(x(8)))))).
readGriglia(griglia(griglia(mappa(76,cella(x(9)))))).
readGriglia(griglia(griglia(mappa(77,cella(x(10)))))).
readGriglia(griglia(griglia(mappa(78,cella(x(11)))))).
readGriglia(griglia(griglia(mappa(79,cella(x(12)))))).
readGriglia(griglia(griglia(mappa(80,cella(x(13)))))).
readGriglia(griglia(griglia(mappa(0,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(1,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(2,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(3,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(4,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(5,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(6,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(7,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(8,cella(y(6)))))).
readGriglia(griglia(griglia(mappa(9,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(10,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(11,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(12,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(13,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(14,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(15,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(16,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(17,cella(y(7)))))).
readGriglia(griglia(griglia(mappa(18,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(19,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(20,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(21,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(22,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(23,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(24,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(25,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(26,cella(y(8)))))).
readGriglia(griglia(griglia(mappa(27,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(28,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(29,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(30,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(31,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(32,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(33,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(34,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(35,cella(y(9)))))).
readGriglia(griglia(griglia(mappa(36,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(37,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(38,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(39,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(40,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(41,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(42,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(43,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(44,cella(y(10)))))).
readGriglia(griglia(griglia(mappa(45,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(46,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(47,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(48,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(49,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(50,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(51,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(52,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(53,cella(y(11)))))).
readGriglia(griglia(griglia(mappa(54,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(55,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(56,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(57,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(58,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(59,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(60,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(61,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(62,cella(y(12)))))).
readGriglia(griglia(griglia(mappa(63,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(64,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(65,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(66,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(67,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(68,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(69,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(70,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(71,cella(y(13)))))).
readGriglia(griglia(griglia(mappa(72,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(73,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(74,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(75,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(76,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(77,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(78,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(79,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(80,cella(y(14)))))).
readGriglia(griglia(griglia(mappa(0,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(1,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(2,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(3,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(4,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(5,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(6,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(7,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(8,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(9,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(10,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(11,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(12,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(13,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(14,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(15,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(16,cella(val(5)))))).
readGriglia(griglia(griglia(mappa(17,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(18,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(19,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(20,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(21,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(22,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(23,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(24,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(25,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(26,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(27,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(28,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(29,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(30,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(31,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(32,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(33,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(34,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(35,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(36,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(37,cella(val(6)))))).
readGriglia(griglia(griglia(mappa(38,cella(val(4)))))).
readGriglia(griglia(griglia(mappa(39,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(40,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(41,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(42,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(43,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(44,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(45,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(46,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(47,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(48,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(49,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(50,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(51,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(52,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(53,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(54,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(55,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(56,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(57,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(58,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(59,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(60,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(61,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(62,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(63,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(64,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(65,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(66,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(67,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(68,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(69,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(70,cella(val(0)))))).
readGriglia(griglia(griglia(mappa(71,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(72,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(73,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(74,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(75,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(76,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(77,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(78,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(79,cella(val(2)))))).
readGriglia(griglia(griglia(mappa(80,cella(val(2)))))).





% setOnActuator(scrivoDir(gameManager(gameManager(x(X))))):-
% setOnActuator(scrivoDir(gameManager(gameManager(y(X))))):-
% setOnActuator(scrivoDir(gameManager(gameManager(x2(X))))):-
% setOnActuator(scrivoDir(gameManager(gameManager(y2(X))))):-
%readDir(random(randomDirection(direction(X)))).
%readGriglia(griglia(griglia(player(x(X))))).
%readGriglia(griglia(griglia(player(y(X))))).
%readGriglia(griglia(griglia(mappa(X,cella(x(V)))))).
%readGriglia(griglia(griglia(mappa(X,cella(y(V)))))).
%readGriglia(griglia(griglia(mappa(X,cella(val(V)))))).

%    1   |    3
%  4 0 3 |  2 0 1
%    2   |    4

% direction(0,0,0).   %% fermo    -- Fermo
% direction(1,20,10). %% Sopra    -- Destra
% direction(2,0,10).  %% Sotto    -- Sinistra
% direction(3,10,20). %% Destra   -- Sopra
% direction(4,10,0).  %% Sinitra  -- Sotto

% celle(X, Y, I, C) :- readGriglia(griglia(griglia(mappa(I,cella(x(X)))))), readGriglia(griglia(griglia(mappa(I,cella(y(Y)))))), readGriglia(griglia(griglia(mappa(I,cella(val(C)))))).
% player(X, Y, I) :- readGriglia(griglia(griglia(mappa(I,cella(x(X)))))), readGriglia(griglia(griglia(mappa(I,cella(y(Y)))))), readGriglia(griglia(griglia(player(x(X))))), readGriglia(griglia(griglia(player(y(Y))))).
% target(X, Y, I) :- celle(X, Y, I, C), C = 3.
% box(X, Y, I)  :- celle(X, Y, I, C), C = 4.
% targetLiberi(X,Y, I) :- target(X,Y,I), not box(X,Y,I).
% stop(N, I) :- targetLiberi(_, _, I), N = 1.

% mifermo :- stop(1, I), player(_, _, PI), PI = I, D = 0. %% stop
% direzioneDaPrendere(D) :- readDir(random(randomDirection(direction(D)))), not mifermo.
% direzioneDaPrendere(0) :- mifermo.

% direzioneDaPrendere(1). % Sopra - in effetti va a destra
% direzioneDaPrendere(2). % Sotto - in effetti va a sinistra
% direzioneDaPrendere(3). % Destra - in effetti va sopra
% direzioneDaPrendere(4). % Sinistra - in effetti va sotto

% scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB-1, D=1.
% scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB+1, D=2. 
% scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB-9, D=3. 
% scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB+9, D=4. 

% giroAttorno(M1,M2) :- player(_,_,NP), scatolaTrovata(D), direzioneDaPrendere(D1), D = 3, D1 = 2, M1=1, M2=3.
% angolo :- giroAttorno(M1, M2).

% setOnActuator(scrivoDir(gameManager(gameManager(x(X))))) :- giroAttorno(D,D2), direction(D,X,Y), angolo.
% setOnActuator(scrivoDir(gameManager(gameManager(y(Y))))) :- giroAttorno(D,D2), direction(D,X,Y), angolo.
% setOnActuator(scrivoDir(gameManager(gameManager(x2(X))))) :- angolo, giroAttorno(D1, D2), direction(D2,X,Y).
% setOnActuator(scrivoDir(gameManager(gameManager(y2(Y))))) :- angolo, giroAttorno(D1, D2), direction(D2,X,Y).

% setOnActuator(scrivoDir(gameManager(gameManager(x(X))))) :- direzioneDaPrendere(D), direction(D,X,Y), not angolo.
% setOnActuator(scrivoDir(gameManager(gameManager(y(Y))))) :- direzioneDaPrendere(D), direction(D,X,Y), not angolo.
% setOnActuator(scrivoDir(gameManager(gameManager(x2(X))))) :- not angolo, X = -1.
% setOnActuator(scrivoDir(gameManager(gameManager(y2(Y))))) :- not angolo, Y = -1.






%%  ' '   0   Spazio 
%%  ';'   1   Nuovo Livello
%%  '#'   2   Muro
%%  '_'   3   Muro v2
%%  '$'   4   Scatola
%%  '@'   5   Personaggio
%%  '.'   6   Target

%   1   |    3
% 4 0 3 |  2 0 1
%   2   |    4

% direction(0,0,0).   %% fermo    -- Fermo
% direction(1,20,10). %% Sopra    -- Destra
% direction(2,0,10).  %% Sotto    -- Sinistra
% direction(3,10,20). %% Destra   -- Sopra
% direction(4,10,0).  %% Sinitra  -- Sotto

% celle(X, Y, I, C) :- readGriglia(griglia(griglia(mappa(I,cella(x(X)))))), readGriglia(griglia(griglia(mappa(I,cella(y(Y)))))), readGriglia(griglia(griglia(mappa(I,cella(val(C)))))).
% player(X, Y, I) :- readGriglia(griglia(griglia(mappa(I,cella(x(X)))))), readGriglia(griglia(griglia(mappa(I,cella(y(Y)))))), readGriglia(griglia(griglia(player(x(X))))), readGriglia(griglia(griglia(player(y(Y))))).
% target(X, Y, I) :- celle(X, Y, I, C), C = 3.
% box(X, Y, I)  :- celle(X, Y, I, C), C = 4.
% targetLiberi(X,Y, I) :- target(X,Y,I), not box(X,Y,I).
% stop(I) :- targetLiberi(_, _, I).

% mifermo :- player(_, _, PI), PI = I, stop(I).
% direzioneDaPrendere(0) :- mifermo.
% direzioneDaPrendere(D) :- readDir(random(randomDirection(direction(D)))), not mifermo.

% dir(1). % Sopra - in effetti va a destra
% dir(2). % Sotto - in effetti va a sinistra
% dir(3). % Destra - in effetti va sopra
% dir(4). % Sinistra - in effetti va sotto

% direzioneDaPrendere(D) :- dir(D), not mifermo.

% setOnActuator(scrivoDir(gameManager(gameManager(x(X))))) :- direzioneDaPrendere(D), direction(D,X,Y).
% setOnActuator(scrivoDir(gameManager(gameManager(y(Y))))) :- direzioneDaPrendere(D), direction(D,X,Y).
direction(0,0,0). %% fermo
direction(1,20,10). %% sopra
direction(2,0,10).  %% sotto
direction(3,10,20). %% destra
direction(4,10,0).  %% sinitra

%% MAPPA %%
celle(X, Y, I, C) :- readGriglia(griglia(griglia(mappa(I,cella(x(X)))))), readGriglia(griglia(griglia(mappa(I,cella(y(Y)))))), readGriglia(griglia(griglia(mappa(I,cella(val(C)))))).
nodo(I) :- readGriglia(griglia(griglia(mappa(I,cella(x(A)))))).

arc(I1, I2) :- nodo(I1), nodo(I2), celle(X1,Y1,I1,C1), celle(X2,Y2,I2,C2), I1 != I2, Y1 = Y2, X2 = X1 + 1, C1 != 2, C2 != 2.   
arc(I1, I2) :- nodo(I1), nodo(I2), celle(X1,Y1,I1,C1), celle(X2,Y2,I2,C2), I1 != I2, Y1 = Y2, X2 = X1 - 1, C1 != 2, C2 != 2.   
arc(I1, I2) :- nodo(I1), nodo(I2), celle(X1,Y1,I1,C1), celle(X2,Y2,I2,C2), I1 != I2, Y1 = Y2 + 1, X2 = X1, C1 != 2, C2 != 2.   
arc(I1, I2) :- nodo(I1), nodo(I2), celle(X1,Y1,I1,C1), celle(X2,Y2,I2,C2), I1 != I2, Y1 = Y2 - 1, X2 = X1, C1 != 2, C2 != 2.   

muro(X, Y, I) :- celle(X, Y, I, C), C = 2.
libero(X, Y, I) :- celle(X, Y, I, C), C = 0.

%% PLAYER %%
player(X, Y, I) :- readGriglia(griglia(griglia(mappa(I,cella(x(X)))))), readGriglia(griglia(griglia(mappa(I,cella(y(Y)))))), readGriglia(griglia(griglia(player(x(X))))), readGriglia(griglia(griglia(player(y(Y))))).

%% BOX %%
box(X, Y, I)  :- celle(X, Y, I, C), C = 4.

%% TARGET %%
target(X, Y, I) :- celle(X, Y, I, C), C = 6.

%% CAMMINO Fase 1 (cerco una scatola) %%
startS(I) :- player(_, _, I), not st.
stopS(I) :- box(_, _, I), not st. %% Va bene perche' per ora la scatola e' una sola. Poi va trovato un modo per selezionarne una (la piu vicina?)

inPath(X,Y) | outPath(X,Y) :- arc(X,Y), not st.
:- inPath(X,Y), inPath(X,Y1), Y != Y1, not st.
:- inPath(X,Y), inPath(X1,Y), X != X1, not st. 
reachedS(X) :- startS(X), not st.
reachedS(X) :- reachedS(Y), inPath(Y,X), not st.
:- stopS(X), not reachedS(X), not st.
:- stopS(X), inPath(X,Y), not st.

scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB-1, D=1.
scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB+1, D=2. 
scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB-9, D=3. 
scatolaTrovata(D) :- player(_,_,NP), box(_,_,NB), NP=NB+9, D=4. 
st :- scatolaTrovata(D).

%% Non mollo piu la scatola
% :- ???

%% CAMMINO Fase 2 (cerco un target) %%
startT(I) :- box(_, _, I), st.
stopT(I) :- target(_, _, I), st. %% Va bene perche' per ora il target e' uno solo. Poi va trovato un modo per selezionarne uno (il piu vicino?)

inPath(X,Y) | outPath(X,Y) :- arc(X,Y), st.
:- inPath(X,Y), inPath(X,Y1), Y != Y1, st.
:- inPath(X,Y), inPath(X1,Y), X != X1, st. 
reachedT(X) :- startT(X), st.
reachedT(X) :- reachedT(Y), inPath(Y,X), st.
:- stopT(X), not reachedT(X), st.
:- stopT(X), inPath(X,Y), st.

giroAttorno(M1,M2) :- player(_,_,NP), scatolaTrovata(D), direzioneDaPrendere(D1), D = 3, D1 = 2, M1=1, M2=4.

angolo :- giroAttorno(M1, M2).

%% Evitiamo i muri
% :- reached(X), muro(X).

%% OTTIMIZZAZIONE %%
% Pago la lunghezza del cammino a lv 1
:~ #count{X,Y: inPath(X,Y)} = C. [C@1]
% Tra cammini di uguale lunghezza preferisco quello che mi fa muovere verso sinistra e in alto
% :~ inPath(A,B), start(A), D = A-B, A > B. [D@2]
% :~ inPath(A,B), start(A), D = B-A, A < B. [D@2]
% Preferisco i cammini con scatole in mezzo
% :~ inPath(X, Y), celle(A, B, Y, C), C != 4. [1@3]

%% OUTPUT (Direzione da prendere) %%
%    1   |    3
%  4 0 3 |  2 0 1
%    2   |    4

direzioneDaPrendere(D) :- player(_, _, PI), inPath(PI, SI), SI=PI+1, D=1, not st. %% Destra
direzioneDaPrendere(D) :- player(_, _, PI), inPath(PI, SI), SI=PI-1, D=2, not st. %% Sinistra
direzioneDaPrendere(D) :- player(_, _, PI), inPath(PI, SI), SI=PI-9, D=4, not st. %% Sopra
direzioneDaPrendere(D) :- player(_, _, PI), inPath(PI, SI), SI=PI+9, D=3, not st. %% Sotto

direzioneDaPrendere(D) :- box(_, _, PI), inPath(PI, SI), SI=PI+1, D=1, st. %% Destra
direzioneDaPrendere(D) :- box(_, _, PI), inPath(PI, SI), SI=PI-1, D=2, st. %% Sinistra
direzioneDaPrendere(D) :- box(_, _, PI), inPath(PI, SI), SI=PI-9, D=4, st. %% Sopra
direzioneDaPrendere(D) :- box(_, _, PI), inPath(PI, SI), SI=PI+9, D=3, st. %% Sotto

playerNextPos(X, Y) :- player(XP, YP, P), inPath(P, I), celle(X, Y, I, C).

playerNextId(I) :- player(XP, YP, P), direzioneDaPrendere(D), D = 1, I = P + 1.
playerNextId(I) :- player(XP, YP, P), direzioneDaPrendere(D), D = 2, I = P - 1.
playerNextId(I) :- player(XP, YP, P), direzioneDaPrendere(D), D = 3, I = P + 9.
playerNextId(I) :- player(XP, YP, P), direzioneDaPrendere(D), D = 4, I = P - 9.

setOnActuator(scrivoDir(gameManager(gameManager(x(X))))) :- giroAttorno(D,D2), direction(D,X,Y), angolo.
setOnActuator(scrivoDir(gameManager(gameManager(y(Y))))) :- giroAttorno(D,D2), direction(D,X,Y), angolo.
setOnActuator(scrivoDir(gameManager(gameManager(x2(X))))) :- angolo, giroAttorno(D1, D2), direction(D2,X,Y).
setOnActuator(scrivoDir(gameManager(gameManager(y2(Y))))) :- angolo, giroAttorno(D1, D2), direction(D2,X,Y).

setOnActuator(scrivoDir(gameManager(gameManager(x(X))))) :- direzioneDaPrendere(D), direction(D,X,Y), not angolo.
setOnActuator(scrivoDir(gameManager(gameManager(y(Y))))) :- direzioneDaPrendere(D), direction(D,X,Y), not angolo.
setOnActuator(scrivoDir(gameManager(gameManager(x2(X))))) :- not angolo, X = -1.
setOnActuator(scrivoDir(gameManager(gameManager(y2(Y))))) :- not angolo, Y = -1.